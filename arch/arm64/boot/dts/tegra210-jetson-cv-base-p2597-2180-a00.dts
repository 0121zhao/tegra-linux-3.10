/*
 * arch/arm64/boot/dts/tegra210-jetson-cv-base-p2597-2180-a00.dts
 *
 * Copyright (c) 2015, NVIDIA CORPORATION.  All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; version 2 of the License.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 *
 */

/dts-v1/;

/memreserve/ 0x80000000 0x00020000;

#include "tegra210-common.dtsi"
#include "tegra210-platforms/tegra210-jetson-cv-power-tree-p2597-2180-a00.dtsi"
#include "tegra210-platforms/tegra210-jetson-cv-pinmux-p2597-2180-a00.dtsi"
#include "tegra210-platforms/tegra210-jetson-cv-sdmmc-drv-p2597-2180-a00.dtsi"
#include "tegra210-platforms/tegra210-pwm-fan-p2530-0930.dtsi"
#include "tegra210-platforms/tegra210-sdhci.dtsi"
#include "tegra210-platforms/tegra210-p2530-common.dtsi"
#include "tegra210-platforms/tegra210-thermal-fan-est-p2530-0930.dtsi"
#include "tegra210-platforms/tegra210-keys-p2530-0930.dtsi"
#include <dt-bindings/iio/meter/ina3221x.h>
#include "tegra210-platforms/tegra210-foster-e-extcon-p2530-0930-e01.dtsi"
#include "tegra210-platforms/tegra210-loki-e-emc-a01.dtsi"
#include "tegra210-platforms/tegra210-edp.dtsi"
#include "tegra210-platforms/tegra210-sysedp.dtsi"
#include "tegra210-platforms/tegra210-thermal-nct72-p2530.dtsi"
#include "tegra210-platforms/tegra210-thermal-Tboard-Tdiode.dtsi"


/ {
	model = "jetson-cv";
	compatible = "nvidia,jetson-cv", "nvidia,tegra210";
	nvidia,dtsfilename = __FILE__;

	nvidia,boardids = "2597:2180:A0";
	nvidia,proc-boardid = "2597:2180:A0";
	nvidia,pmu-boardid = "2597:2180:A0";
	#address-cells = <2>;
	#size-cells = <2>;

	chosen {
        };

	pmc@7000e400 {
		nvidia,invert-interrupt;
		platform-io-pad-voltage = <
				TEGRA210_PAD_AUDIO_HV IO_PAD_VOLTAGE_1_8V
				TEGRA210_PAD_SPI_HV IO_PAD_VOLTAGE_1_8V>;
	};

	memory@80000000 {
		device_type = "memory";
		reg = < 0x0 0x80000000 0x0 0x80000000 >;
	};

	sdhci@700b0600 { /* SDMMC4 for EMMC */
		uhs-mask = <0x0>;
		built-in;
		pll_source = "pll_p", "pll_c4_out2";
		power-off-rail;
		status = "okay";
	};

	sdhci@700b0200 { /* SDMMC2 for Wifi */
		uhs-mask = <0x8>;
		power-off-rail;
		status = "okay";
	};

	sdhci@700b0000 { /* SDMMC1 for SD card */
		uhs-mask = <0xc>;
		power-off-rail;
		nvidia,update-pinctrl-settings;
		pinctrl-names = "sdmmc_schmitt_enable", "sdmmc_schmitt_disable", "sdmmc_clk_schmitt_enable", "sdmmc_clk_schmitt_disable", "sdmmc_drv_code", "sdmmc_default_drv_code";
		pinctrl-0 = <&sdmmc1_schmitt_enable_state>;
		pinctrl-1 = <&sdmmc1_schmitt_disable_state>;
		pinctrl-2 = <&sdmmc1_clk_schmitt_enable_state>;
		pinctrl-3 = <&sdmmc1_clk_schmitt_disable_state>;
		pinctrl-4 = <&sdmmc1_drv_code_1_8V>;
		pinctrl-5 = <&sdmmc1_default_drv_code_3_3V>;
		nvidia,sd-device;
		wp-gpios = <&gpio TEGRA_GPIO_PZ4 0>;
		status = "okay";
	};

	adma@702e2000  {
		interrupts = <0 24 0x04
			      0 25 0x04
			      0 26 0x04
			      0 27 0x04
			      0 28 0x04
			      0 29 0x04
			      0 30 0x04
			      0 31 0x04
			      0 32 0x04
			      0 33 0x04>;
		dma-channels = <10>;
		status = "okay";
	};

	sata@70020000 {
		compatible = "nvidia,tegra210-ahci-sata";
		nvidia,enable-sata-port;
		status = "okay";
	};

	backlight {
		compatible = "pwm-backlight";
		status = "okay";
		panel-s-wqxga-10-1-bl {
			pwms = <&tegra_pwm 0 1000000>;
		};
		panel-a-wuxga-8-0-bl {
			pwms = <&tegra_pwm 0 40161>;
		};
	};

	pcie-controller {
		nvidia,wake-gpio = <&gpio TEGRA_GPIO(A, 2) 0>;
		nvidia,lane-map = <0x14>;
		dvdd-pex-pll-supply = <&max77620_ldo1>;
		l0-dvddio-pex-supply = <&max77620_ldo1>;
		l1-dvddio-pex-supply = <&max77620_ldo1>;
		l2-dvddio-pex-supply = <&max77620_ldo1>;
		l3-dvddio-pex-supply = <&max77620_ldo1>;
		l4-dvddio-pex-supply = <&max77620_ldo1>;
		l5-dvddio-pex-supply = <&max77620_ldo1>;
		l6-dvddio-pex-supply = <&max77620_ldo1>;
		hvdd-pex-pll-e-supply = <&max77620_sd3>;
		l0-hvddio-pex-supply = <&max77620_sd3>;
		l1-hvddio-pex-supply = <&max77620_sd3>;
		l2-hvddio-pex-supply = <&max77620_sd3>;
		l3-hvddio-pex-supply = <&max77620_sd3>;
		l4-hvddio-pex-supply = <&max77620_sd3>;
		l5-hvddio-pex-supply = <&max77620_sd3>;
		l6-hvddio-pex-supply = <&max77620_sd3>;
		vddio-pex-ctl-supply = <&max77620_sd3>;
		status = "okay";

		pci@1,0 {
			status = "okay";
		};

		pci@2,0 {
			status = "okay";
		};
	};

	spi@7000da00 {
		status = "ok";
	};

	spi@7000d400 {
		status = "okay";
	};

	extcon {
		extcon@0 {
			status = "disabled";
		};
	};

	udc@7d000000 {
		nvidia,port-otg;
		nvidia,charging-supported;
		#extcon-cells = <1>;
		status = "okay";
	};

        otg@7d000000 {
		#extcon-cells = <1>;
		status = "okay";
	};

	xusb_pad_ctl: padctl@0 { /* Put common control config here */
		nvidia,ss_portmap = <0x21>;
		nvidia,lane_owner = <0xff56>; /* Use 0xF to disable lane assign */
		status = "okay";
	};

	xusb@70090000 {
		/* nvidia,uses_external_pmic;
		/* nvidia,gpio_controls_muxed_ss_lanes; */
		nvidia,gpio_ss1_sata = <0>;
		nvidia,ulpicap = <0>; /* No ulpi support. can we remove */
		nvidia,portmap = <0x0e02>;
		nvidia,common_padctl = <&xusb_pad_ctl>;
		status = "okay";
	};

	xudc@700d0000 {
		nvidia,common_padctl = <&xusb_pad_ctl>;
		nvidia,portmap = <0x0108>;
		#extcon-cells = <1>;
		status = "disabled";
	};

	xotg {
		#extcon-cells = <1>;
		nvidia,common_padctl = <&xusb_pad_ctl>;
		status = "disabled";
	};

	gpio-keys {
		power {
			gpios = <&gpio TEGRA_GPIO(X, 7) GPIO_ACTIVE_LOW>;
		};

		sw_lid {
			status="disabled";
		};
	};

	gpu-dvfs-rework {
		status = "disabled";
	};

	thermal-fan-est {
		compatible = "thermal-fan-est";
		active_trip_temps = <0 63000 74000 85000 120000
				140000 150000 160000 170000 180000>;
		active_hysteresis = <0 15000 11000 6000 4000
				0 0 0 0 0>;
	};

	pwm-fan {
		compatible = "pwm-fan";
		shared_data = <&pwm_fan_shared_data>;
		active_pwm = <0 70 115 135 135 240 245 250 252 255>;
	};

	i2c@7000c000 {
		rt5639: rt5639.0-001c@1c {
			compatible = "realtek,rt5639";
			reg = <0x1c>;
		};
	};

	i2c@7000c400 {
		nvidia,clock-always-on;

		tca9539_74: tca9539@74 {
			compatible = "ti,tca9539";
			gpio-controller;
			#gpio-cells = <2>;
			reg = <0x74>;
			interrupt-parent = <&gpio>;
			interrupts = <TEGRA_GPIO(L, 1) 0x0>;
			gpio-init-names = "default";
			gpio-init-0 = <&tca9539_74_default>;
			tca9539_74_default: default {
				/*
				 * GPIO-10 : M2_E_ALERT_R_L
				 * GPIO-13 : TOUCH_ID
				 */
				gpio-input = <10 13>;

				/*
				 * GPIO-1 : EN_VDD_TS_1V8_PMIC
				 * GPIO-2 : EN_VDD_TS_HV_PMIC
				 * GPIO-3 : EN_VDD_DISP,
				 * GPIO-4 : PS_VDD_FAN_ENABLE
				 * GPIO-5 : MDM_EN
				 * GPIO-7 : MDM_EN, MDM_PWR_EN
				 * GPIO-11 : VDD_DISP_MUX_EN
				 * GPIO-12 : FLASH_INHIBIT
				 * GPIO-14 : 5V0_HDMI_EN
				 * GPIO-15 : EN_VDD_CAM_HV
				 * GPIO-16,17 : TP83, TP84
				 */
				gpio-output-low = <1 2 3 4 5 7 11 12 14 15 16 17>;

				/*
				 * GPIO-0 : W_DISABLE_L
				 * GPIO-6 : MDM_RST_L
				 */
				gpio-output-high = <0 6>;
			};
		};

		tca9539_77: tca9539@77 {
			compatible = "ti,tca9539";
			gpio-controller;
			#gpio-cells = <2>;
			reg = <0x77>;
			interrupt-parent = <&gpio>;
			interrupts = <TEGRA_GPIO(Z, 2) 0x0>;
			gpio-init-names = "default";
			gpio-init-0 = <&tca9539_74_default>;
			tca9539_77_default: default {
				/*
				 * GPIO-0 : DISP_CHARGER_STAT
				 * GPIO-1 : DISP_TYPEC_ORIENT
				 */
				gpio-input = <0 1>;

				/*
				 * GPIO-2 : TYPEC_INT		 Charger control HDR
				 * GPIO-3 : VDD_SYS_EN		 CAM HEADER
				 * GPIO-4 : LCD_BIAS_EN		 CAM HEADER
				 * GPIO-5 : TORCH_EN		 CAM HEADER
				 * GPIO-6 : FLASH_INHIBIT 	 CAM HEADER
				 * GPIO-7 : CAM2_PWDN		 CAM HEADER
				 * GPIO-10 : CAM2_RST		 CAM HEADER
				 * GPIO-11 : CAM_VDD_1V8_EN 	 CAM HEADER
				 * GPIO-12 : CAM_VDD_1V2_EN 	 CAM HEADER
				 * GPIO-13 : CAM_AF_PWDN    	 CAM HEADER
				 * GPIO-14 : CHG_BD_PRSNT_L 	 CAM HEADER
				 * GPIO-15 : BRIDGE_EN		 CAM HEADER
				 * GPIO-16 : NVSR_INT		 CAM HEADER
				 * GPIO-17 : BRIDGE_IRQ		 CAM HEADER
				 */
				gpio-output-low = <2 3 4 5 6 7 10 11 12 13 14 15 16 17>;
			};
		};
	};

	i2c@546c0000 {
		avdd_dsi_csi-supply = <&max77620_gpio7>;
	};

	sysedp {
		compatible = "nvidia,tegra124-sysedp";
		nvidia,margin = <0>;
		nvidia,min_budget = <0>;
		nvidia,initial_budget = <40000>;

		consumers {
			consumer1 {
				nvidia,consumer_name = "ov7695";
				nvidia,states = <0 124>;
			};
			consumer2 {
				nvidia,consumer_name = "primary-wifi";
				nvidia,states = <0 2345>;
			};
			consumer3 {
				nvidia,consumer_name = "secondary-wifi";
				nvidia,states = <0 1170>;
			};
			/*eMMC*/
			consumer4 {
				nvidia,consumer_name = "sdhci-tegra.3";
				nvidia,states = <0 1785>;
			};
			consumer5 {
				nvidia,consumer_name = "display_0";
				nvidia,states = <0 616>;
			};
			consumer6 {
				nvidia,consumer_name = "display_1";
				nvidia,states = <0 616>;
			};
			consumer7 {
				nvidia,consumer_name = "codec+speaker";
				nvidia,states = <0 1270>;
			};
			consumer8 {
				nvidia,consumer_name = "pwm-backlight";
				nvidia,states = <0 127 255 382 510 638 765 893 1020 1148 1276>;
			};
			/*SD Card */
			consumer9 {
				nvidia,consumer_name = "sdhci-tegra.0";
				nvidia,states = <0 1785>;
			};
		};
	};

    sysedp_reactive_capping@3 {
        compatible = "nvidia,tegra124-sysedp_reactive_capping";
        nvidia,max_capping_mw = <15000>;
        nvidia,step_alarm_mw = <1000>;
        nvidia,step_relax_mw = <500>;
        nvidia,relax_ms = <250>;
        interrupt-parent = <&soctherm>;
        interrupts = <3 0x2002>;
        sysedpc {
            nvidia,name = "batmon_oc3";
        };
    };

    sysedp-dynamic-capping {
        compatible = "nvidia,tegra124-sysedp-dynamic-capping";
        nvidia,throttle_depth = <75>;
        nvidia,cap_method = <1>;
    };

	cpu_edp {
		status = "okay";
		nvidia,edp_limit = <25000>;
	};

	gpu_edp {
		status = "okay";
		nvidia,edp_limit = <25000>;
	};

	modem {
		/* using XHCI UTMI */
		nvidia,phy-type = <2>;
	};

	soctherm@0x700E2000 {
		throttle@oc1 {
			device_type = "throttlectl";
			oc-alarm-id = <1>;
			priority = <50>;
			mode = "brief";
			intr;
			active_low;
			count_threshold = <100>;
			filter = <5100000>;
			throttle_dev = <&{/soctherm@0x700E2000/throttle_dev@cpu_medium}
					&{/soctherm@0x700E2000/throttle_dev@gpu_medium}>;
		};
		throttle@oc3 {
			device_type = "throttlectl";
			oc-alarm-id = <3>;
			priority = <50>;
			mode = "brief";
			intr;
			active_low;
			count_threshold = <15>;
			filter = <5100000>;
			throttle_dev = <&{/soctherm@0x700E2000/throttle_dev@cpu_medium}
					&{/soctherm@0x700E2000/throttle_dev@gpu_medium}>;
		};
		throttle_dev@cpu_medium {
			dividend = <63>;
			divisor = <255>;
			duration = <0>;
			step = <0>;
		};
		throttle_dev@gpu_medium {
			level = "medium_throttling";
		};
	};

	thermal-zones {
		CPU-therm {
			thermal-zone-params {
				governor-name = "pid_thermal_gov";
				max_err_temp = <9000>;
				max_err_gain = <1000>;
				gain_p = <1000>;
				gain_d = <0>;
				up_compensation = <20>;
				down_compensation = <20>;
			};
			trips {
				cpu_critical {
					temperature = <102500>;
					hysteresis = <0>;
					type = "critical";
					writable;
				};
				cpu_heavy {
					temperature = <98500>;
					hysteresis = <0>;
					type = "hot";
					writable;
				};
				cpu_throttle {
					temperature = <89000>;
					hysteresis = <0>;
					type = "passive";
					writable;
				};
			};
			cooling-maps {
				map0 {
					trip = <&{/thermal-zones/CPU-therm/trips/cpu_critical}>;
					cdev-type = "tegra-shutdown";
					cooling-device = <&{/soctherm@0x700E2000/throttle@critical}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
				map1 {
					trip = <&{/thermal-zones/CPU-therm/trips/cpu_heavy}>;
					cdev-type = "tegra-heavy";
					cooling-device = <&{/soctherm@0x700E2000/throttle@heavy}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
				map2 {
					trip = <&{/thermal-zones/CPU-therm/trips/cpu_throttle}>;
					cdev-type = "cpu-balanced";
					cooling-device = <&{/bthrot_cdev/cpu_balanced}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
			};
		};
		GPU-therm {
			thermal-zone-params {
				governor-name = "pid_thermal_gov";
				max_err_temp = <9000>;
				max_err_gain = <1000>;
				gain_p = <1000>;
				gain_d = <0>;
				up_compensation = <20>;
				down_compensation = <20>;
			};
			trips {
				gpu_critical {
					temperature = <103000>;
					hysteresis = <0>;
					type = "critical";
					writable;
				};
				gpu_heavy {
					temperature = <100000>;
					hysteresis = <0>;
					type = "hot";
					writable;
				};
				gpu_throttle {
					temperature = <90500>;
					hysteresis = <0>;
					type = "passive";
					writable;
				};
			};
			cooling-maps {
				map0 {
					trip = <&{/thermal-zones/GPU-therm/trips/gpu_critical}>;
					cdev-type = "tegra-shutdown";
					cooling-device = <&{/soctherm@0x700E2000/throttle@critical}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
				map1 {
					trip = <&{/thermal-zones/GPU-therm/trips/gpu_heavy}>;
					cdev-type = "tegra-heavy";
					cooling-device = <&{/soctherm@0x700E2000/throttle@heavy}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
				map2 {
					trip = <&{/thermal-zones/GPU-therm/trips/gpu_throttle}>;
					cdev-type = "gpu-balanced";
					cooling-device = <&{/bthrot_cdev/gpu_balanced}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
			};
		};
		LCPU-therm {
			thermal-zone-params {
				governor-name = "pid_thermal_gov";
				max_err_temp = <9000>;
				max_err_gain = <1000>;
				gain_p = <1000>;
				gain_d = <0>;
				up_compensation = <20>;
				down_compensation = <20>;
			};
			trips {
				lcpu_critical {
					temperature = <103000>; /* must be same as GPU's critical temp */
					hysteresis = <0>;
					type = "critical";
					writable;
				};
				lcpu_heavy {
					temperature = <101500>;
					hysteresis = <0>;
					type = "hot";
					writable;
				};
				lcpu_throttle {
					temperature = <92000>;
					hysteresis = <0>;
					type = "passive";
					writable;
				};
			};
			cooling-maps {
				map0 {
					trip = <&{/thermal-zones/LCPU-therm/trips/lcpu_critical}>;
					cdev-type = "tegra-shutdown";
					cooling-device = <&{/soctherm@0x700E2000/throttle@critical}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
				map1 {
					trip = <&{/thermal-zones/LCPU-therm/trips/lcpu_heavy}>;
					cdev-type = "tegra-heavy";
					cooling-device = <&{/soctherm@0x700E2000/throttle@heavy}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
				map2 {
					trip = <&{/thermal-zones/LCPU-therm/trips/lcpu_throttle}>;
					cdev-type = "cpu-balanced";
					cooling-device = <&{/bthrot_cdev/cpu_balanced}
						THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
			};
		};
		PLL-therm {
			thermal-zone-params {
				governor-name = "pid_thermal_gov";
				max_err_temp = <9000>;
				max_err_gain = <1000>;
				gain_p = <1000>;
				gain_d = <0>;
				up_compensation = <20>;
				down_compensation = <20>;
			};
		};

		Tboard_tegra {
			status = "okay";
		};
		Tdiode_tegra {
			status = "okay";
		};
	};

	soctherm@0x700E2000 {
		throttle@oc3 {
			device_type = "throttlectl";
			oc-alarm-id = <3>;
			priority = <50>;
			mode = "brief";
			intr;
			active_low;
			count_threshold = <15>;
			filter = <5100000>;
			throttle_dev = <&{/soctherm@0x700E2000/throttle_dev@cpu_medium}
					&{/soctherm@0x700E2000/throttle_dev@gpu_medium}>;
		};
		throttle_dev@cpu_medium {
			dividend = <63>;
			divisor = <255>;
			duration = <0>;
			step = <0>;
		};
		throttle_dev@gpu_medium {
			level = "medium_throttling";
		};
	};

	sysedp_reactive_capping@3 {
		compatible = "nvidia,tegra124-sysedp_reactive_capping";
		nvidia,max_capping_mw = <15000>;
		nvidia,step_alarm_mw = <1000>;
		nvidia,step_relax_mw = <500>;
		nvidia,relax_ms = <250>;
		interrupt-parent = <&soctherm>;
		interrupts = <3 0x2002>;
		sysedpc {
			nvidia,name = "batmon_oc3";
		};
	};

	sysedp-dynamic-capping {
		compatible = "nvidia,tegra124-sysedp-dynamic-capping";
		nvidia,throttle_depth = <75>;
		nvidia,cap_method = <1>;
	};

};
